# =============================================================================
# mail-done Environment Configuration
# =============================================================================
# Copy this file to .env and fill in your actual values:
#   cp .env.example .env
#   vim .env
#
# SECURITY: Never commit .env to git! It contains secrets.
# =============================================================================

# =============================================================================
# DATABASE CONFIGURATION (Required)
# =============================================================================
# PostgreSQL with pgvector extension

# For Docker deployment (uses internal network)
POSTGRES_USER=postgres
POSTGRES_PASSWORD=change-this-secure-password
POSTGRES_DB=email_processor
POSTGRES_PORT=5432

# Connection string - choose based on your deployment:
#
# Docker Compose (default) - uses container network:
DATABASE_URL=postgresql://postgres:change-this-secure-password@db:5432/email_processor
#
# Raspberry Pi / Podman with host networking:
# DATABASE_URL=postgresql://postgres:${POSTGRES_PASSWORD}@localhost:5432/email_processor
#
# Local development (no Docker):
# DATABASE_URL=postgresql://postgres:password@localhost:5432/email_processor

# Database field encryption key (REQUIRED - backup this key!)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
DB_ENCRYPTION_KEY=generate-a-fernet-key-here

# =============================================================================
# IMAP CONFIGURATION (Required)
# =============================================================================
# Configure at least one email account
#
# NOTE: Server hosts/ports are configured in config/accounts.yaml
# Only credentials (username/password) are stored here for security.
# See config/accounts.example.yaml for the full account configuration.

# --- Work Account ---
# Host/port: Set in config/accounts.yaml â†’ accounts.work.imap.host
IMAP_USERNAME_WORK=your.email@company.com
IMAP_PASSWORD_WORK=your-app-password
SMTP_USERNAME_WORK=your.email@company.com
SMTP_PASSWORD_WORK=your-app-password

# --- Personal Account (Optional) ---
# IMAP_USERNAME_PERSONAL=your.email@gmail.com
# IMAP_PASSWORD_PERSONAL=your-app-password
# SMTP_USERNAME_PERSONAL=your.email@gmail.com
# SMTP_PASSWORD_PERSONAL=your-app-password

# --- Archive Account (Optional) ---
# IMAP_USERNAME_WORK_ARCHIVE=archive@company.com
# IMAP_PASSWORD_WORK_ARCHIVE=your-app-password

# --- Microsoft 365 OAuth2 (Optional) ---
# For Office 365 accounts that require OAuth2 instead of app passwords
# To obtain a refresh token, use the Microsoft identity platform:
# https://learn.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-auth-code-flow
# IMAP_USERNAME_ETH=your.email@organization.edu
# OAUTH2_REFRESH_TOKEN_ETH=your-oauth2-refresh-token

# =============================================================================
# LLM PROVIDER CONFIGURATION (Required for AI features)
# =============================================================================

# --- OpenAI Configuration ---
OPENAI_API_KEY=sk-your-openai-api-key-here

# --- Azure OpenAI Configuration (Alternative to OpenAI) ---
# Primary region
# AZURE_OPENAI_API_KEY=your-azure-api-key
# AZURE_OPENAI_ENDPOINT=https://your-resource.openai.azure.com
# AZURE_OPENAI_API_VERSION=2025-04-01-preview

# Secondary region (optional, for model routing - see llm_endpoints.yaml)
# AZURE_OPENAI_SWEDEN_API_KEY=your-sweden-api-key
# AZURE_OPENAI_SWEDEN_ENDPOINT=https://your-sweden-resource.openai.azure.com

# Embedding provider: "openai" or "azure"
EMBEDDING_PROVIDER=openai

# Model for name extraction (optional)
# AZURE_OPENAI_NAME_EXTRACT_MODEL=gpt-4o-mini

# --- Anthropic Configuration (Optional) ---
# ANTHROPIC_API_KEY=sk-ant-your-anthropic-api-key
# ANTHROPIC_MODEL=claude-3-haiku-20240307

# --- Local LLM Configuration (Optional - Ollama) ---
# OLLAMA_BASE_URL=http://localhost:11434
# OLLAMA_MODEL=llama2

# =============================================================================
# API SECURITY (Required for production)
# =============================================================================

# API key for authenticating requests
# Generate with: python -c "import secrets; print(secrets.token_urlsafe(32))"
API_KEY=generate-a-new-api-key-here

# Security monitoring
SECURITY_ALERT_EMAIL=admin@yourdomain.com
SECURITY_UNLOCK_KEY=generate-a-new-key-here

# Backend public URL (required for OAuth callbacks)
# BACKEND_PUBLIC_URL=https://your-api-url.example.com

# =============================================================================
# MCP SERVER CONFIGURATION (For Claude/Cursor integration)
# =============================================================================

# MCP API key (can be same as API_KEY)
MCP_API_KEY=generate-a-new-key-here

# Backend API key for MCP server to authenticate with backend
BACKEND_API_KEY=same-as-api-key-above

# Backend API URL for MCP server
EMAIL_API_URL=http://localhost:8000

# MCP Query Restrictions (Security)
# Restrict queries to a specific account_id (e.g., "work", "personal")
# Leave empty to allow all accounts
MCP_ALLOWED_ACCOUNT=work

# MCP Date Range Limits
MCP_DATE_LIMIT_DAYS=730     # Max: 2 years (hard limit)
MCP_DEFAULT_DAYS=90         # Default: 3 months

# =============================================================================
# SAFETY CONFIGURATION
# =============================================================================

# Set to true to prevent actual email actions (RECOMMENDED for testing)
DRY_RUN=true

# Set to false to actually execute email actions (be careful!)
# DRY_RUN=false

# =============================================================================
# ATTACHMENT HANDLING
# =============================================================================

# Enable attachment API endpoints
ENABLE_ATTACHMENT_API=true

# Enable MCP attachment downloads (requires explicit opt-in)
MCP_ENABLE_ATTACHMENTS=false

# Attachment cache directory
MCP_ATTACHMENT_CACHE_DIR=/tmp/mail-done-attachments

# =============================================================================
# GOOGLE SERVICES (Optional - for Google Drive integration)
# =============================================================================

# Service account for server-to-server authentication
# GOOGLE_SERVICE_ACCOUNT_PATH=path/to/service-account.json

# OAuth2 for user authentication (Web UI)
# GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com
# GOOGLE_CLIENT_SECRET=your-client-secret
# GOOGLE_REDIRECT_URI=http://localhost:8000/auth/google/callback

# Google Drive folder IDs (for application review features)
# GOOGLE_DRIVE_SOURCE_MATERIAL_FOLDER_ID=folder-id-here
# GOOGLE_DRIVE_SPREADSHEET_FOLDER_ID=folder-id-here

# =============================================================================
# APPLICATION SETTINGS
# =============================================================================

# Log level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL=INFO

# Maximum emails to process per run (for testing/safety)
MAX_EMAILS_PER_RUN=100

# Enable IMAP debug logging (very verbose)
IMAP_DEBUG=false

# API port
API_PORT=8000

# =============================================================================
# EMAIL PROCESSING RULES
# =============================================================================

# Default folders for email categories
FOLDER_RECEIPTS=Receipts
FOLDER_NEWSLETTERS=Newsletters
FOLDER_ARCHIVE=Archive
FOLDER_URGENT=Urgent

# Default color for urgent emails (Apple Mail)
# 1=Red, 2=Orange, 3=Yellow, 4=Green, 5=Blue, 6=Purple, 7=Gray
URGENT_COLOR=1

# Senders to exclude from reference letter extraction (comma-separated)
# REFERENCE_LETTER_EXCLUDE_SENDERS=your.email@company.com,other@company.com

# =============================================================================
# WEB UI CONFIGURATION (if running web-ui separately)
# =============================================================================

# Backend API URL for web UI to connect to
# BACKEND_API_URL=http://localhost:8000

# Web UI port
# WEB_UI_PORT=8080

# Web UI base URL (for OAuth callbacks)
# WEB_UI_BASE_URL=http://localhost:8080

# Environment: "production" or "development"
# ENVIRONMENT=production

# Enable macOS Mail.app integration (only works on macOS)
# ENABLE_MACOS_FEATURES=true
